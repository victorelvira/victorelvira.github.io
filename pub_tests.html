<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Víctor Elvira's webpage</title>



      <!-- Bootstrap 5 CSS -->
      <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> -->
      <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/flatly/bootstrap.min.css" rel="stylesheet">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css">
      <!-- CSS -->
      <link href="assets/css/styles.css" rel="stylesheet">       <!-- Custom CSS -->

      <!-- JS -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="assets/js/scripts.js"></script>
  <script type="text/javascript" src="assets/js/bibtex_js.js"></script> <!-- Load bibtex-js -->

</head>
<body>

<!-- Load Navbar from nav.html -->
<div id="navbar-placeholder"></div>

<!-- Publications Section -->
<div class="container py-5">
    <h2>Publications</h2>
    
    <!-- Filter buttons -->
<div id="filter-buttons" class="mb-3">
  <button class="btn btn-primary filter-btn" data-type="all">All Papers</button>
  <button class="btn btn-outline-primary filter-btn" data-type="article">Journals</button>
  <button class="btn btn-outline-primary filter-btn" data-type="inproceedings">Conferences</button>
  <button class="btn btn-outline-primary filter-btn" data-type="other">Other</button>
</div>
    <!-- Reverse ordered list for publications -->
    <ol reversed id="bibtex_display">
        <!-- The BibTeX entries will be dynamically added here -->
    </ol>
</div>

<!-- Footer -->
<div id="footer-placeholder"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 
<script>
if (!window.__pub_init_done__) {
  window.__pub_init_done__ = true;

  async function loadBib() {
    const res = await fetch('publications.bib?v=' + Date.now(), { cache: 'no-store' });
    if (!res.ok) throw new Error('publications.bib not found');
    return await res.text();
  }

  function decodeAccents(text) {
    return (text || "")
      .replace(/{|}/g, '')
      .replace(/\\'\\i/g, 'í').replace(/\\'a/g, 'á').replace(/\\'e/g, 'é').replace(/\\'E/g, 'É')
      .replace(/\\'i/g, 'í').replace(/\\'o/g, 'ó').replace(/\\'u/g, 'ú')
      .replace(/\\"u/g, 'ü').replace(/\\c\{c\}/g, 'ç')
      .replace(/\\~n/g, 'ñ').replace(/\\`a/g, 'à').replace(/\\`e/g, 'è')
      .replace(/\\`i/g, 'ì').replace(/\\`o/g, 'ò').replace(/\\`u/g, 'ù')
      .replace(/\\"O/g, 'Ö')
      .replace(/\\'c/g, 'ć');
  }

  function inferEntryType(e) {
    // 1) si el parser lo puso con otro nombre
    const t = (e.entryType || e.type || e.ENTRYTYPE || '').toLowerCase();
    if (t) return t;

    // 2) inferir por campos
    if (e.JOURNAL)     return 'article';
    if (e.BOOKTITLE)   return 'inproceedings';
    if (e.SCHOOL || e.PHDTHESIS || (e.BIBTEX && /@phdthesis/i.test(e.BIBTEX))) return 'phdthesis';
    if (e.BIBTEX && /@mastersthesis/i.test(e.BIBTEX)) return 'mastersthesis';
    if (e.BIBTEX && /@inbook/i.test(e.BIBTEX))        return 'inbook';
    if (e.BIBTEX && /@incollection/i.test(e.BIBTEX))  return 'incollection';
    if (e.BIBTEX && /@book/i.test(e.BIBTEX))          return 'book';
    if (e.BIBTEX && /@techreport/i.test(e.BIBTEX))    return 'techreport';

    // 3) como último recurso, mirar el encabezado del BIBTEX genérico
    if (e.BIBTEX) {
      const m = e.BIBTEX.match(/@(\w+)/i);
      if (m) return m[1].toLowerCase();
    }
    return 'misc';
  }

  function formatAuthors(authorString) {
    if (!authorString) return 'Unknown';
    const authors = authorString.split(/\s+and\s+/).map(a => {
      a = decodeAccents(a.trim());
      if (a.includes(',')) {
        const [last, first] = a.split(',').map(s => s.trim());
        return `${first} ${last}`.trim();
      }
      return a;
    });
    return authors.join(', ');
  }

  function normDOI(doi) {
    if (!doi) return '';
    const d = doi.trim();
    if (!d) return '';
    if (d.startsWith('http')) return d;
    if (d.startsWith('10.')) return 'https://doi.org/' + d;
    return d;
  }

  function renderEntryLI(entry) {
    const title  = entry['TITLE']  || 'Untitled';
    const year   = (entry['YEAR']  || '').trim();
    const authors = formatAuthors(entry['AUTHOR'] || '');
    // const etype  = (entry['ENTRYTYPE'] || '').toLowerCase();
        const etype  = inferEntryType(entry);

console.log("Etype???")
    console.log(etype)

    const isJournal = !!entry['JOURNAL'];
    const isConf    = !!entry['BOOKTITLE'];

    const venue = [];
    if (isJournal) {
      const vol = entry['VOLUME'] ? `, ${entry['VOLUME']}` : '';
      const num = entry['NUMBER'] ? `(${entry['NUMBER']})` : '';
      // const pgs = entry['PAGES']  ? `, pp. ${entry['PAGES']}` : '';
      const pgs = entry['PAGES'] ? `, pp. ${entry['PAGES'].replace(/--/g, '–')}` : '';
      venue.push(`<em>${entry['JOURNAL']}</em>${vol}${num}${pgs}`);
    } else if (isConf) {
      const pgs = entry['PAGES'] ? `, pp. ${entry['PAGES'].replace(/--/g, '–')}` : '';
      venue.push(`<em>${entry['BOOKTITLE']}</em>${pgs}`);
    }

    const doiURL = normDOI(entry['DOI']);
    const arxiv  = entry['ARXIV'] || entry['EPRINT'] || '';
    const url    = entry['URL'];

    let buttons = '';
    buttons += ` <button class="btn btn-mini btn-danger bibtex_but">PDF</button>`;
    if (arxiv) buttons += ` <a class="btn btn-mini btn-success"  target="_blank" rel="noopener" href="${arxiv}">arXiv</a>`;
    if (url)   buttons += ` <a class="btn btn-mini btn-info"     target="_blank" rel="noopener" href="${url}">URL</a>`;
    if (doiURL)buttons += ` <a class="btn btn-mini btn-primary"  target="_blank" rel="noopener" href="${doiURL}">DOI</a>`;
    buttons += ` <button class="btn btn-mini btn-secondary bibtex_but">BibTeX</button>`;

    return `
      <li class="pub-item" data-entrytype="${etype}">
        <em>${authors}</em>, <strong>"${decodeAccents(title)},"</strong> 
        ${venue.join(' ')}${year ? '. ' + year : ''}.
        <div class="mt-1">${buttons}</div>
      </li>`;
  }


  function safeType(e){
  const et = (e.ENTRYTYPE || '').toLowerCase();
  if (et) return et;
  if (e.JOURNAL)     return 'article';
  if (e.BOOKTITLE)   return 'inproceedings';
  if (e.SCHOOL)      return 'phdthesis';
  if (e.HOWPUBLISHED)return 'misc';
  return 'unknown';
}
  // cache global para no reparsear cada vez
  let __BIB_ENTRIES__ = null;

async function renderPublications(filterType = "all") {
  const $out = $("#bibtex_display").empty();
  try {
    if (!__BIB_ENTRIES__) {
      const raw = await loadBib();
      const parser = new BibtexParser();
      parser.setInput(raw); parser.bibtex();
      __BIB_ENTRIES__ = parser.getEntries();
    }
    Object.keys(__BIB_ENTRIES__).forEach(k => {
      const e  = __BIB_ENTRIES__[k];
      const t  = safeType(e);

      // Filtro
      if (filterType === 'other' && (t === 'article' || t === 'inproceedings')) return;
      if (filterType !== 'all' && filterType !== 'other' && t !== filterType)   return;

      $("#bibtex_display").append( renderEntryLI(e) );
    });
  } catch (err) {
    console.error(err);
    $out.append('<li><em>Could not load publications.bib</em></li>');
  }
}

  $(function () {
    // Render inicial: todo
    renderPublications("all");

    // Delegación de eventos en la botonera ya presente en el HTML
    $("#filter-buttons").off("click.pub").on("click.pub", "button.filter-btn", async function () {
      // Toggle visual bootstrap
      $("#filter-buttons .filter-btn")
        .removeClass("btn-primary active")
        .addClass("btn-outline-primary");

      $(this)
        .removeClass("btn-outline-primary")
        .addClass("btn-primary active");

      // Tipo a filtrar (all / article / inproceedings)
      const type = $(this).data("type") || "all";
      await renderPublications(type);
    });
  });
}
</script>
<!-- Tracking: Google Analytics tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GHT1L88XYZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GHT1L88XYZ');
</script>
<!-- End Google Analytics tag (gtag.js) -->

<!-- Default Statcounter code for Github personal
https://victorelvira.github.io/index.html -->
<script type="text/javascript">
var sc_project=11157426; 
var sc_invisible=1; 
var sc_security="c4968ba5"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/11157426/0/c4968ba5/1/"
alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->
</body>
</html>
